<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - Gest√£o de Frota</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2 class="mb-4 text-center">üìä Dashboard da Frota</h2>

    <div class="text-end mb-4">
      <a href="/backup" class="btn btn-outline-primary">üì¶ Baixar Banco de Dados</a>
    </div>

    <div class="row g-4 mb-4">
      <div class="col-md-6">
        <canvas id="chartStatus"></canvas>
      </div>
      <div class="col-md-6">
        <canvas id="chartDevolucao"></canvas>
      </div>
    </div>

    {% if prereservas %}
    <div class="alert alert-warning">
      <h5 class="mb-3">‚ö†Ô∏è Pr√©-Reservas Pendentes:</h5>
      <ul class="mb-0">
        {% for r in prereservas %}
        <li>
          <strong>{{ r[1] }}</strong> ({{ r[3] }} ‚Üí {{ r[4] }}) - 
          {% if r[7] == 'Sim' %}‚úîÔ∏è Locado - Valor: R$ {{ r[8] or 'N/A' }}{% else %}‚ùå N√£o locado{% endif %}
          [<a href="/admin/prereservas/editar/{{ r[0] }}">Editar</a>]
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    <hr class="my-4">

    <h4 class="mb-3">üìë √öltimas Reservas</h4>
    <table class="table table-bordered table-sm bg-white">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Nome</th>
          <th>Placa</th>
          <th>Retirada</th>
          <th>Devolu√ß√£o</th>
        </tr>
      </thead>
      <tbody>
        {% for r in registros %}
          <tr>
            <td>{{ r[0] }}</td>
            <td>{{ r[1] }}</td>
            <td>{{ r[3] }}</td>
            <td>{{ r[4] }}</td>
            <td>{{ r[5] }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <script>
    const statusData = {
      labels: {{ status_count.keys()|list }},
      datasets: [{
        label: 'Ve√≠culos por Status',
        data: {{ status_count.values()|list }},
        backgroundColor: ['#198754', '#ffc107', '#dc3545', '#0dcaf0']
      }]
    };

    new Chart(document.getElementById('chartStatus'), {
      type: 'pie',
      data: statusData
    });

    const devolucaoData = {
      labels: {{ devolucao_count.keys()|list }},
      datasets: [{
        label: 'Status Final na Devolu√ß√£o',
        data: {{ devolucao_count.values()|list }},
        backgroundColor: ['#0d6efd', '#6f42c1', '#fd7e14']
      }]
    };

    new Chart(document.getElementById('chartDevolucao'), {
      type: 'doughnut',
      data: devolucaoData
    });
  </script>
</body>
</html>